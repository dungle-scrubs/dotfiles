"use strict";(()=>{var J,g,ye,Ge,I,he,be,ke,we,ae,re,oe,Je,W={},He=[],Qe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Q=Array.isArray;function E(e,t){for(var n in t)e[n]=t[n];return e}function se(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Xe(e,t,n){var r,a,o,s={};for(o in t)o=="key"?r=t[o]:o=="ref"?a=t[o]:s[o]=t[o];if(arguments.length>2&&(s.children=arguments.length>3?J.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)s[o]===void 0&&(s[o]=e.defaultProps[o]);return V(e,s,r,a,null)}function V(e,t,n,r,a){var o={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++ye,__i:-1,__u:0};return a==null&&g.vnode!=null&&g.vnode(o),o}function S(e){return e.children}function Z(e,t){this.props=e,this.context=t}function N(e,t){if(t==null)return e.__?N(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?N(e):null}function Le(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Le(e)}}function ve(e){(!e.__d&&(e.__d=!0)&&I.push(e)&&!G.__r++||he!=g.debounceRendering)&&((he=g.debounceRendering)||be)(G)}function G(){for(var e,t,n,r,a,o,s,_=1;I.length;)I.length>_&&I.sort(ke),e=I.shift(),_=I.length,e.__d&&(n=void 0,r=void 0,a=(r=(t=e).__v).__e,o=[],s=[],t.__P&&((n=E({},r)).__v=r.__v+1,g.vnode&&g.vnode(n),le(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[a]:null,o,a??N(r),!!(32&r.__u),s),n.__v=r.__v,n.__.__k[n.__i]=n,Ce(o,n,s),r.__e=r.__=null,n.__e!=a&&Le(n)));G.__r=0}function Te(e,t,n,r,a,o,s,_,c,l,f){var i,h,u,k,p,v,d,m=r&&r.__k||He,C=t.length;for(c=Ye(n,t,m,c,C),i=0;i<C;i++)(u=n.__k[i])!=null&&(h=u.__i==-1?W:m[u.__i]||W,u.__i=i,v=le(e,u,h,a,o,s,_,c,l,f),k=u.__e,u.ref&&h.ref!=u.ref&&(h.ref&&_e(h.ref,null,u),f.push(u.ref,u.__c||k,u)),p==null&&k!=null&&(p=k),(d=!!(4&u.__u))||h.__k===u.__k?c=Me(u,c,e,d):typeof u.type=="function"&&v!==void 0?c=v:k&&(c=k.nextSibling),u.__u&=-7);return n.__e=p,c}function Ye(e,t,n,r,a){var o,s,_,c,l,f=n.length,i=f,h=0;for(e.__k=new Array(a),o=0;o<a;o++)(s=t[o])!=null&&typeof s!="boolean"&&typeof s!="function"?(typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?s=e.__k[o]=V(null,s,null,null,null):Q(s)?s=e.__k[o]=V(S,{children:s},null,null,null):s.constructor==null&&s.__b>0?s=e.__k[o]=V(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):e.__k[o]=s,c=o+h,s.__=e,s.__b=e.__b+1,(l=s.__i=et(s,n,c,i))!=-1&&(i--,(_=n[l])&&(_.__u|=2)),_==null||_.__v==null?(l==-1&&(a>f?h--:a<f&&h++),typeof s.type!="function"&&(s.__u|=4)):l!=c&&(l==c-1?h--:l==c+1?h++:(l>c?h--:h++,s.__u|=4))):e.__k[o]=null;if(i)for(o=0;o<f;o++)(_=n[o])!=null&&!(2&_.__u)&&(_.__e==r&&(r=N(_)),Se(_,_));return r}function Me(e,t,n,r){var a,o;if(typeof e.type=="function"){for(a=e.__k,o=0;a&&o<a.length;o++)a[o]&&(a[o].__=e,t=Me(a[o],t,n,r));return t}e.__e!=t&&(r&&(t&&e.type&&!t.parentNode&&(t=N(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function et(e,t,n,r){var a,o,s,_=e.key,c=e.type,l=t[n],f=l!=null&&(2&l.__u)==0;if(l===null&&_==null||f&&_==l.key&&c==l.type)return n;if(r>(f?1:0)){for(a=n-1,o=n+1;a>=0||o<t.length;)if((l=t[s=a>=0?a--:o++])!=null&&!(2&l.__u)&&_==l.key&&c==l.type)return s}return-1}function me(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||Qe.test(t)?n:n+"px"}function O(e,t,n,r,a){var o,s;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||me(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||me(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")o=t!=(t=t.replace(we,"$1")),s=t.toLowerCase(),t=s in e||t=="onFocusOut"||t=="onFocusIn"?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?r?n.u=r.u:(n.u=ae,e.addEventListener(t,o?oe:re,o)):e.removeEventListener(t,o?oe:re,o);else{if(a=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function ge(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=ae++;else if(t.t<n.u)return;return n(g.event?g.event(t):t)}}}function le(e,t,n,r,a,o,s,_,c,l){var f,i,h,u,k,p,v,d,m,C,L,D,A,z,U,$,j,T=t.type;if(t.constructor!=null)return null;128&n.__u&&(c=!!(32&n.__u),o=[_=t.__e=n.__e]),(f=g.__b)&&f(t);e:if(typeof T=="function")try{if(d=t.props,m="prototype"in T&&T.prototype.render,C=(f=T.contextType)&&r[f.__c],L=f?C?C.props.value:f.__:r,n.__c?v=(i=t.__c=n.__c).__=i.__E:(m?t.__c=i=new T(d,L):(t.__c=i=new Z(d,L),i.constructor=T,i.render=nt),C&&C.sub(i),i.state||(i.state={}),i.__n=r,h=i.__d=!0,i.__h=[],i._sb=[]),m&&i.__s==null&&(i.__s=i.state),m&&T.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=E({},i.__s)),E(i.__s,T.getDerivedStateFromProps(d,i.__s))),u=i.props,k=i.state,i.__v=t,h)m&&T.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),m&&i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(m&&T.getDerivedStateFromProps==null&&d!==u&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(d,L),t.__v==n.__v||!i.__e&&i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(d,i.__s,L)===!1){for(t.__v!=n.__v&&(i.props=d,i.state=i.__s,i.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(w){w&&(w.__=t)}),D=0;D<i._sb.length;D++)i.__h.push(i._sb[D]);i._sb=[],i.__h.length&&s.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(d,i.__s,L),m&&i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(u,k,p)})}if(i.context=L,i.props=d,i.__P=e,i.__e=!1,A=g.__r,z=0,m){for(i.state=i.__s,i.__d=!1,A&&A(t),f=i.render(i.props,i.state,i.context),U=0;U<i._sb.length;U++)i.__h.push(i._sb[U]);i._sb=[]}else do i.__d=!1,A&&A(t),f=i.render(i.props,i.state,i.context),i.state=i.__s;while(i.__d&&++z<25);i.state=i.__s,i.getChildContext!=null&&(r=E(E({},r),i.getChildContext())),m&&!h&&i.getSnapshotBeforeUpdate!=null&&(p=i.getSnapshotBeforeUpdate(u,k)),$=f,f!=null&&f.type===S&&f.key==null&&($=Ee(f.props.children)),_=Te(e,Q($)?$:[$],t,n,r,a,o,s,_,c,l),i.base=t.__e,t.__u&=-161,i.__h.length&&s.push(i),v&&(i.__E=i.__=null)}catch(w){if(t.__v=null,c||o!=null)if(w.then){for(t.__u|=c?160:128;_&&_.nodeType==8&&_.nextSibling;)_=_.nextSibling;o[o.indexOf(_)]=null,t.__e=_}else{for(j=o.length;j--;)se(o[j]);ie(t)}else t.__e=n.__e,t.__k=n.__k,w.then||ie(t);g.__e(w,t,n)}else o==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):_=t.__e=tt(n.__e,t,n,r,a,o,s,c,l);return(f=g.diffed)&&f(t),128&t.__u?void 0:_}function ie(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(ie)}function Ce(e,t,n){for(var r=0;r<n.length;r++)_e(n[r],n[++r],n[++r]);g.__c&&g.__c(t,e),e.some(function(a){try{e=a.__h,a.__h=[],e.some(function(o){o.call(a)})}catch(o){g.__e(o,a.__v)}})}function Ee(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:Q(e)?e.map(Ee):E({},e)}function tt(e,t,n,r,a,o,s,_,c){var l,f,i,h,u,k,p,v=n.props||W,d=t.props,m=t.type;if(m=="svg"?a="http://www.w3.org/2000/svg":m=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),o!=null){for(l=0;l<o.length;l++)if((u=o[l])&&"setAttribute"in u==!!m&&(m?u.localName==m:u.nodeType==3)){e=u,o[l]=null;break}}if(e==null){if(m==null)return document.createTextNode(d);e=document.createElementNS(a,m,d.is&&d),_&&(g.__m&&g.__m(t,o),_=!1),o=null}if(m==null)v===d||_&&e.data==d||(e.data=d);else{if(o=o&&J.call(e.childNodes),!_&&o!=null)for(v={},l=0;l<e.attributes.length;l++)v[(u=e.attributes[l]).name]=u.value;for(l in v)if(u=v[l],l!="children"){if(l=="dangerouslySetInnerHTML")i=u;else if(!(l in d)){if(l=="value"&&"defaultValue"in d||l=="checked"&&"defaultChecked"in d)continue;O(e,l,null,u,a)}}for(l in d)u=d[l],l=="children"?h=u:l=="dangerouslySetInnerHTML"?f=u:l=="value"?k=u:l=="checked"?p=u:_&&typeof u!="function"||v[l]===u||O(e,l,u,v[l],a);if(f)_||i&&(f.__html==i.__html||f.__html==e.innerHTML)||(e.innerHTML=f.__html),t.__k=[];else if(i&&(e.innerHTML=""),Te(t.type=="template"?e.content:e,Q(h)?h:[h],t,n,r,m=="foreignObject"?"http://www.w3.org/1999/xhtml":a,o,s,o?o[0]:n.__k&&N(n,0),_,c),o!=null)for(l=o.length;l--;)se(o[l]);_||(l="value",m=="progress"&&k==null?e.removeAttribute("value"):k!=null&&(k!==e[l]||m=="progress"&&!k||m=="option"&&k!=v[l])&&O(e,l,k,v[l],a),l="checked",p!=null&&p!=e[l]&&O(e,l,p,v[l],a))}return e}function _e(e,t,n){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&t==null||(e.__u=e(t))}else e.current=t}catch(a){g.__e(a,n)}}function Se(e,t,n){var r,a;if(g.unmount&&g.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||_e(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){g.__e(o,t)}r.base=r.__P=null}if(r=e.__k)for(a=0;a<r.length;a++)r[a]&&Se(r[a],t,n||typeof e.type!="function");n||se(e.__e),e.__c=e.__=e.__e=void 0}function nt(e,t,n){return this.constructor(e,n)}function xe(e,t,n){var r,a,o,s;t==document&&(t=document.documentElement),g.__&&g.__(e,t),a=(r=typeof n=="function")?null:n&&n.__k||t.__k,o=[],s=[],le(t,e=(!r&&n||t).__k=Xe(S,null,[e]),a||W,W,t.namespaceURI,!r&&n?[n]:a?null:t.firstChild?J.call(t.childNodes):null,o,!r&&n?n:a?a.__e:t.firstChild,r,s),Ce(o,e,s)}J=He.slice,g={__e:function(e,t,n,r){for(var a,o,s;t=t.__;)if((a=t.__c)&&!a.__)try{if((o=a.constructor)&&o.getDerivedStateFromError!=null&&(a.setState(o.getDerivedStateFromError(e)),s=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(e,r||{}),s=a.__d),s)return a.__E=a}catch(_){e=_}throw e}},ye=0,Ge=function(e){return e!=null&&e.constructor==null},Z.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=E({},this.state),typeof e=="function"&&(e=e(E({},n),this.props)),e&&E(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),ve(this))},Z.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ve(this))},Z.prototype.render=S,I=[],be=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ke=function(e,t){return e.__v.__b-t.__v.__b},G.__r=0,we=/(PointerCapture)$|Capture$/i,ae=0,re=ge(!1),oe=ge(!0),Je=0;var q,y,ce,De,B=0,Re=[],b=g,Ae=b.__b,Ie=b.__r,Pe=b.diffed,Ue=b.__c,$e=b.unmount,Ne=b.__;function fe(e,t){b.__h&&b.__h(y,e,B||t),B=0;var n=y.__H||(y.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function K(e){return B=1,rt(qe,e)}function rt(e,t,n){var r=fe(q++,2);if(r.t=e,!r.__c&&(r.__=[n?n(t):qe(void 0,t),function(_){var c=r.__N?r.__N[0]:r.__[0],l=r.t(c,_);c!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=y,!y.__f)){var a=function(_,c,l){if(!r.__c.__H)return!0;var f=r.__c.__H.__.filter(function(h){return!!h.__c});if(f.every(function(h){return!h.__N}))return!o||o.call(this,_,c,l);var i=r.__c.props!==_;return f.forEach(function(h){if(h.__N){var u=h.__[0];h.__=h.__N,h.__N=void 0,u!==h.__[0]&&(i=!0)}}),o&&o.call(this,_,c,l)||i};y.__f=!0;var o=y.shouldComponentUpdate,s=y.componentWillUpdate;y.componentWillUpdate=function(_,c,l){if(this.__e){var f=o;o=void 0,a(_,c,l),o=f}s&&s.call(this,_,c,l)},y.shouldComponentUpdate=a}return r.__N||r.__}function F(e,t){var n=fe(q++,3);!b.__s&&We(n.__H,t)&&(n.__=e,n.u=t,y.__H.__h.push(n))}function Y(e){return B=5,je(function(){return{current:e}},[])}function je(e,t){var n=fe(q++,7);return We(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function ee(e,t){return B=8,je(function(){return e},t)}function ot(){for(var e;e=Re.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(X),e.__H.__h.forEach(ue),e.__H.__h=[]}catch(t){e.__H.__h=[],b.__e(t,e.__v)}}b.__b=function(e){y=null,Ae&&Ae(e)},b.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Ne&&Ne(e,t)},b.__r=function(e){Ie&&Ie(e),q=0;var t=(y=e.__c).__H;t&&(ce===y?(t.__h=[],y.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(X),t.__h.forEach(ue),t.__h=[],q=0)),ce=y},b.diffed=function(e){Pe&&Pe(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Re.push(t)!==1&&De===b.requestAnimationFrame||((De=b.requestAnimationFrame)||it)(ot)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),ce=y=null},b.__c=function(e,t){t.some(function(n){try{n.__h.forEach(X),n.__h=n.__h.filter(function(r){return!r.__||ue(r)})}catch(r){t.some(function(a){a.__h&&(a.__h=[])}),t=[],b.__e(r,n.__v)}}),Ue&&Ue(e,t)},b.unmount=function(e){$e&&$e(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{X(r)}catch(a){t=a}}),n.__H=void 0,t&&b.__e(t,n.__v))};var Fe=typeof requestAnimationFrame=="function";function it(e){var t,n=function(){clearTimeout(r),Fe&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,35);Fe&&(t=requestAnimationFrame(n))}function X(e){var t=y,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),y=t}function ue(e){var t=y;e.__c=e.__(),y=t}function We(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function qe(e,t){return typeof t=="function"?t(e):t}var Be=e=>{let t=[],n="asdfghjklqwertyuiopzxcvbnm";for(let r=0;r<Math.min(e,n.length);r++)t.push(n[r]);if(e>n.length)for(let r=0;r<n.length&&t.length<e;r++)for(let a=0;a<n.length&&t.length<e;a++)t.push(n[r]+n[a]);return t};var at=0,mt=Array.isArray;function H(e,t,n,r,a,o){t||(t={});var s,_,c=t;if("ref"in c)for(_ in c={},t)_=="ref"?s=t[_]:c[_]=t[_];var l={type:e,props:c,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--at,__i:-1,__u:0,__source:a,__self:o};if(typeof e=="function"&&(s=e.defaultProps))for(_ in s)c[_]===void 0&&(c[_]=s[_]);return g.vnode&&g.vnode(l),l}var P=[],M="",st=()=>{let e=document.querySelectorAll(".thread-link"),t=Be(e.length);P=[],e.forEach((n,r)=>{let a=t[r],o=n,s=o.querySelector(".hint-badge");s||(s=document.createElement("span"),s.className="hint-badge",o.appendChild(s)),s.textContent=a,s.dataset.full=a;let _=o.dataset.threadTs||o.getAttribute("data-thread-ts");P.push({label:a,element:o,action:()=>{_?x("thread:"+_):o.click()}})})},lt=e=>{if(!/^[a-z]$/i.test(e))return M="",R(),!1;M+=e.toLowerCase();let t=P.find(r=>r.label===M);return t?(M="",R(),t.action(),!0):P.filter(r=>r.label.startsWith(M)).length===0?(M="",R(),!1):(R(),!0)},R=()=>{P.forEach(e=>{let t=e.element.querySelector(".hint-badge");if(t)if(M&&e.label.startsWith(M)){let n=e.label.substring(0,M.length),r=e.label.substring(M.length);t.innerHTML=`<span class="hint-matched">${n}</span>${r}`,t.classList.add("hint-active")}else t.textContent=e.label,t.classList.remove("hint-active"),M?t.classList.add("hint-dimmed"):t.classList.remove("hint-dimmed")})},x=e=>{window.webkit?.messageHandlers?.hammerspoon?.postMessage(e)},Oe=e=>e?(e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="#" class="link" data-url="$2">$1</a>'),e=e.replace(/(^|[^"'])(https?:\/\/[^\s<]+)/g,(t,n,r)=>n+'<a href="#" class="link" data-url="'+r+'">'+r+"</a>"),e=e.replace(/<@([A-Z0-9]+)>/g,'<span class="mention">@user</span>'),e=e.replace(/@([a-zA-Z0-9._-]+)/g,'<span class="mention">@$1</span>'),e=e.replace(/\n/g,"<br>"),e):"",de=({msg:e,onThreadClick:t})=>{let n=window.appState.viewMode==="history"&&e.replyCount>0,r=e.isReply?"message reply":"message";return H("div",{class:r,"data-id":e.id,children:[H("div",{class:"message-header",children:[H("span",{class:"sender",children:e.user}),H("span",{class:"time",children:e.time})]}),H("div",{class:"message-text",dangerouslySetInnerHTML:{__html:Oe(e.text)}}),n&&H("span",{class:"thread-link","data-thread-ts":e.threadTs,onClick:()=>t(e.threadTs),children:[e.replyCount," replies"]})]})},_t=({count:e})=>H("div",{class:"thread-separator",children:["Thread (",e," replies)"]}),ct=()=>{let[e,t]=K(window.appState.messages),[n,r]=K(!1),[a,o]=K(window.appState.isInitialLoading),[s,_]=K("."),c=Y(null),l=Y(null),f=Y(0);F(()=>{if(!a)return;let p=setInterval(()=>{_(v=>v==="."?"..":v===".."?"...":".")},300);return()=>clearInterval(p)},[a]),F(()=>{window.updateMessages=(p,v=!1)=>{if(v&&c.current&&l.current){let d=Date.now()-f.current,C=Math.max(0,750-d);setTimeout(()=>{let L=c.current,D=l.current;if(!L||!D)return;let A=L.scrollHeight,z=L.scrollTop,U=p.map(w=>{let Ve=w.isReply?"message reply":"message",Ze=window.appState.viewMode==="history"&&w.replyCount>0;return`<div class="${Ve}" data-id="${w.id}">
              <div class="message-header">
                <span class="sender">${w.user}</span>
                <span class="time">${w.time}</span>
              </div>
              <div class="message-text">${Oe(w.text)}</div>
              ${Ze?`<span class="thread-link" data-thread-ts="${w.threadTs}">${w.replyCount} replies</span>`:""}
            </div>`}).join("");D.insertAdjacentHTML("afterbegin",U);let j=L.scrollHeight-A;L.scrollTop=z+j;let T=L.querySelector(".loading-indicator");if(T){T.classList.remove("visible");let w=T;w._animateId&&(clearInterval(w._animateId),w._animateId=void 0)}window.appState.isLoadingMore=!1},C)}else t(p),r(!1),o(!1),window.appState.isLoadingMore=!1,window.appState.isInitialLoading=!1,requestAnimationFrame(()=>{let d=c.current;d&&(d.scrollTop=d.scrollHeight)})},window.setLoading=p=>{r(p)}},[]),F(()=>{let p=c.current;p&&!window.keepScrollPosition&&(p.scrollTop=p.scrollHeight)},[]);let i=ee(()=>{let p=c.current;if(!p)return;let v=p.querySelector(".loading-indicator");if(!v)return;f.current=Date.now(),v.classList.add("visible");let d=0,m=setInterval(()=>{d=d%3+1;let C=".".repeat(d)+" ".repeat(3-d);v.textContent="Loading"+C},300);v._animateId=m},[]),h=ee(p=>{let v=p.target;v.scrollTop<0||v.scrollTop<50&&!window.appState.isLoadingMore&&(window.appState.isLoadingMore=!0,i(),x("loadMore"))},[i]),u=ee(p=>{x("thread:"+p)},[]);return F(()=>{let p=v=>{let d=v.target.closest("a.link");if(d){v.preventDefault();let m=d.getAttribute("data-url");m&&x("openUrl:"+m)}};return document.addEventListener("click",p),()=>document.removeEventListener("click",p)},[]),F(()=>{!a&&e.length>0&&requestAnimationFrame(()=>{st()})},[e,a]),H("div",{class:"content",id:"content",ref:c,onScroll:h,children:[H("div",{class:"loading-indicator",children:"Loading."}),a?H("div",{class:"initial-loading",children:["Loading",s]}):H("div",{ref:l,children:window.appState.viewMode==="thread"&&e.length>1?H(S,{children:[H(de,{msg:e[0],onThreadClick:u}),H(_t,{count:e.length-1}),e.slice(1).map(p=>H(de,{msg:{...p,isReply:!0},onThreadClick:u},p.id))]}):e.map(p=>H(de,{msg:p,onThreadClick:u},p.id))})]})},Ke=0,te="",pe=!1,ut=()=>{P.length!==0&&(pe=!0,M="",document.body.classList.add("hint-mode"),R())},ne=()=>{pe=!1,M="",document.body.classList.remove("hint-mode"),R()};document.addEventListener("keydown",e=>{let t=document.getElementById("content");if(!t)return;let n=60,r=t.clientHeight*.8,a=Date.now();if(pe){if(e.key==="Escape"){ne(),e.preventDefault();return}if(/^[a-z]$/i.test(e.key)){lt(e.key)?M===""&&ne():ne(),e.preventDefault();return}ne()}if(e.key==="f"&&!e.ctrlKey&&!e.metaKey&&!e.altKey&&window.appState.viewMode==="history"&&P.length>0){ut(),e.preventDefault();return}if(e.key==="g"&&!e.shiftKey){if(te==="g"&&a-Ke<500){t.scrollTop=0,te="",e.preventDefault();return}te="g",Ke=a,e.preventDefault();return}if(e.key==="G"&&e.shiftKey){t.scrollTop=t.scrollHeight,e.preventDefault();return}switch(te="",e.key){case"j":t.scrollTop+=n,e.preventDefault();break;case"k":t.scrollTop-=n,e.preventDefault();break;case"d":e.ctrlKey&&(t.scrollTop+=r,e.preventDefault());break;case"u":e.ctrlKey?(t.scrollTop-=r,e.preventDefault()):e.metaKey||(console.log("[app.tsx] u pressed, showChannelUp="+window.appState.showChannelUp+", viewMode="+window.appState.viewMode),window.appState.showChannelUp&&(x("channelUp"),e.preventDefault()));break;case"b":x("back"),e.preventDefault();break;case"O":x("openSlack"),e.preventDefault();break;case"Escape":x("back"),e.preventDefault();break}});var ze=()=>{let e=document.getElementById("app");e&&xe(H(ct,{}),e)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ze):ze();})();
